import json
import objectpath
import glob
from collections import defaultdict
import pandas as pd
import numpy as np
import os

# Get Current path
path = os.path.dirname(os.path.realpath('JSON Parser.py'))

# Getting all files in directory
# path =r'C://Users//lab//Desktop//Assembly Dataset//test//test//'
allFiles = glob.glob(path + "CuckooReportParser/json-reports/1.json")

Data = pd.DataFrame()
Features = ['ID',
            'Name',
            'SHA1',
            'SHA256',
            'SHA512',
            'MD5',
            'Sender IP',
            'Reciever IP',
            'Duration',
            'Severity Score',
            'Category',
            'Package',
            'Size',
            'Type',
            'Label',
            'Label 2']
Dataset = pd.DataFrame(columns=Features)

i = 1
for f in allFiles:
    # Opening Json file
    #Opening Json file
    with open(f, 'r') as datafile:
        print(datafile)
        data = datafile.read()
        #print(data)
    data = json.loads(data)
    # show values
    print("id: " + str(data['info']["id"]))
    print(data["target"]["file"]["name"])  # Name

    print("info: " + str(data['info']))
#    print("procmemory: " + str(data['procmemory']))
    print("target: " + str(data['target']))
    print("network: " + str(data['network']))
    print("signatures: " + str(data['signatures']))
    print("static: " + str(data['static']))
    print("behavior: " + str(data['behavior']))
    print("debug: " + str(data['debug']))
    print("screenshots: " + str(data['screenshots']))
    print("strings: " + str(data['strings']))
    print("metadata: " + str(data['metadata']))

    print("id: " + str(data['info']["id"]))
    print(data["target"]["file"]["name"])  # Name
    print(data["target"]["file"]["sha1"])  # SHA1
    print(data["target"]["file"]["sha256"])  # SHA256
    print(data["target"]["file"]["sha512"])  # SHA512
    print(data["target"]["file"]["md5"])  # MD5
#    print(data["network"]["udp"][0]["src"])  # Sender IP
 #   print(data["network"]["udp"][0]["dst"])  # Reciever IP
    print(data["info"]["duration"])  # Duration of Execution
    print(data["info"]["score"])  # Severity Score
    print(data["info"]["category"])  # Category
    print(data["info"]["package"])  # Package i.e. exe
    print(data["target"]["file"]["size"])  # Size Bytes
    print(data["target"]["file"]["type"])  # File Type
    print(data["static"]["imported_dll_count"])  # Dll import count

Dataset.loc[i] = [data['info']["id"],
                  data["target"]["file"]["name"],
                  data["target"]["file"]["sha1"],
                  data["target"]["file"]["sha256"],
                  data["target"]["file"]["sha512"],
                  data["target"]["file"]["md5"],
                  data["network"]["udp"][0]["src"],
                  data["network"]["udp"][0]["dst"],
                  data["info"]["duration"],
                  data["info"]["score"],
                  data["info"]["category"],
                  data["info"]["package"],
                  data["target"]["file"]["size"],
                  data["target"]["file"]["type"],
                  "Malware",
                  "1"
                  ]
i = i + 1

